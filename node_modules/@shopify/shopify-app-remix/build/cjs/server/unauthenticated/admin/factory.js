'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var shopifyApi = require('@shopify/shopify-api');
var factory = require('../../clients/admin/factory.js');

function unauthenticatedAdminContextFactory(params) {
  return async shop => {
    const offlineSessionId = params.api.session.getOfflineId(shop);
    const session = await params.config.sessionStorage.loadSession(offlineSessionId);
    if (!session) {
      throw new shopifyApi.ShopifyError(`Could not find a session for shop ${shop} when creating unauthenticated admin context`);
    }
    return {
      session,
      admin: factory.adminClientFactory({
        params,
        session
      })
    };
  };
}

exports.unauthenticatedAdminContextFactory = unauthenticatedAdminContextFactory;
